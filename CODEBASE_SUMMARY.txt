â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          PERPUSTAKAAN DIGITAL - CODEBASE EXPLORATION COMPLETE             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ“Š PROJECT OVERVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Framework:      Laravel 12 (PHP)
Frontend:       Blade Templates + Vanilla JavaScript
Database:       SQLite / Configurable
Styling:        Tailwind CSS 4.0
PDF Reading:    PDF.js 3.11.174
Build Tool:     Vite 7.0


ğŸ—ï¸  ARCHITECTURE OVERVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

App Structure:
  app/
  â”œâ”€â”€ Http/Controllers/
  â”‚   â”œâ”€â”€ Frontend/           â† Student features (HomeController, BookController)
  â”‚   â”œâ”€â”€ Admin/              â† Admin features (DashboardController, BookController)
  â”‚   â””â”€â”€ Auth/               â† LoginController
  â”œâ”€â”€ Models/
  â”‚   â”œâ”€â”€ User.php            â† User with reading stats
  â”‚   â”œâ”€â”€ Book.php            â† Book metadata
  â”‚   â””â”€â”€ History.php         â† Reading session tracker â­ CORE
  â””â”€â”€ Middleware/             â† IsStudent, IsAdmin, Authenticate

Resources:
  resources/
  â”œâ”€â”€ views/
  â”‚   â”œâ”€â”€ layouts/            â† app.blade.php (main layout)
  â”‚   â”œâ”€â”€ frontend/           â† home.blade.php, reader.blade.php â­ TIMER HERE
  â”‚   â”œâ”€â”€ auth/               â† login.blade.php
  â”‚   â””â”€â”€ admin/              â† dashboard.blade.php
  â”œâ”€â”€ js/                     â† app.js, bootstrap.js
  â””â”€â”€ css/                    â† app.css (Tailwind config)

Database:
  Users Table                 (id, name, email, password, role, is_active)
  Books Table                 (id, judul, kategori, cover_image, file_path, total_pages)
  Histories Table â­ CORE    (id, user_id, book_id, last_page, total_time_spent, last_ping_at)


ğŸ“– READING WORKFLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. LOGIN
   â””â”€ GET /login â†’ LoginController

2. HOME PAGE (SHOWS STATS)
   â””â”€ GET /home â†’ HomeController@index
      â”œâ”€ Shows: Total Reading Time, Books Read
      â”œâ”€ Calculates: SUM(histories.total_time_spent)
      â””â”€ Displays: Last 4 books to continue reading

3. VIEW BOOK DETAILS
   â””â”€ GET /buku/{id} â†’ BookController@show
      â””â”€ Displays: Cover, Title, Synopsis, "Start Reading" button

4. START READING
   â””â”€ POST /buku/{id}/start â†’ BookController@startReading
      â”œâ”€ Creates History record (if doesn't exist)
      â””â”€ Redirects to reader

5. READER PAGE (â­ TIMER ACTIVE)
   â””â”€ GET /buku/{id}/read â†’ BookController@read
      â”œâ”€ Renders: PDF.js viewer
      â”œâ”€ Shows: Timer (HH:MM:SS) in header
      â”œâ”€ Features: 
      â”‚  â”œâ”€ Page navigation (arrows, buttons)
      â”‚  â”œâ”€ Keyboard shortcuts (arrow keys, escape)
      â”‚  â”œâ”€ Page auto-save on scroll
      â”‚  â””â”€ Dark mode toggle
      â”‚
      â””â”€ JavaScript:
         â”œâ”€ updateTimer() every 1s (display only)
         â””â”€ sendPing() every 15s (server persistence)

6. TIME ACCUMULATION (Every 15 seconds)
   â””â”€ POST /buku/{id}/ping â†’ BookController@ping â­ TIMER LOGIC
      â”œâ”€ Calculates: delta = now - last_ping_at
      â”œâ”€ Accumulates: total_time_spent += min(delta, 600)
      â”œâ”€ Updates: last_ping_at = now (anchor for next delta)
      â””â”€ Returns: {total_time_spent, delta}

7. EXIT READER
   â””â”€ Calls:
      â”œâ”€ saveProgress() â†’ Updates last_page
      â”œâ”€ sendPing() â†’ Final time accumulation
      â””â”€ Redirect to book detail page

8. HISTORY PAGE
   â””â”€ GET /history â†’ HistoryController@index
      â””â”€ Shows: All books read + total time


â±ï¸  HOW THE TIMER WORKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Core Components:

  Backend (Source of Truth):
  â”œâ”€ History.total_time_spent        (cumulative seconds in database)
  â”œâ”€ History.last_ping_at            (anchor point for delta)
  â””â”€ POST /ping endpoint             (accumulates time every 15s)

  Frontend (Display Only):
  â”œâ”€ serverTotalSeconds              (from database via data attribute)
  â”œâ”€ lastPingTimestamp               (from database via data attribute)
  â”œâ”€ Display = serverTotal + (now - lastPing)
  â””â”€ updateTimer() every 1s          (smooth visual update)


Timer Flow Example:

  T=0s:   Page load
          â”œâ”€ History created: total_time_spent=0, last_ping_at=0s
          â”œâ”€ Frontend: serverTotalSeconds=0, lastPingTimestamp=0s
          â””â”€ Display: 00:00:00

  T=10s:  First ping (sent every 15s)
          â”œâ”€ Backend: delta = 10 - 0 = 10s
          â”œâ”€ Database: total_time_spent = 0 + 10 = 10s, last_ping_at=10s
          â”œâ”€ Frontend: serverTotalSeconds=10, lastPingTimestamp=10s
          â””â”€ Display: 00:00:10

  T=15s:  User refreshes (F5)
          â”œâ”€ Backend: Retrieves History (still 10s, 10s)
          â”œâ”€ Frontend: Initialize from data attributes
          â””â”€ Display: 00:00:10 âœ“ (NOT RESET!)

  T=20s:  Second ping
          â”œâ”€ Backend: delta = 20 - 10 = 10s
          â”œâ”€ Database: total_time_spent = 10 + 10 = 20s, last_ping_at=20s
          â””â”€ Display: 00:00:20 âœ“


Key Principles:

  1. total_time_spent is CUMULATIVE (always +=, never =)
  2. last_ping_at is the ANCHOR for next delta calculation
  3. Frontend display = server data + elapsed since last ping
  4. Only persistence via ping endpoint (every 15s)
  5. Max 600s per ping prevents cheating


ğŸ—„ï¸  DATABASE SCHEMA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

USERS TABLE:
  id (PK)
  name
  email (UNIQUE)
  password (hashed)
  role (ENUM: admin, student)
  is_active (BOOLEAN)
  created_at, updated_at

BOOKS TABLE:
  id (PK)
  judul
  kategori
  sinopsis
  cover_image (path)
  file_path (path to PDF)
  total_pages
  is_active (BOOLEAN)
  created_at, updated_at

HISTORIES TABLE (â­ CORE):
  id (PK)
  user_id (FK)
  book_id (FK)
  last_page (INT)
  total_time_spent (INT SECONDS)    â† CUMULATIVE
  last_read_at (TIMESTAMP)
  last_ping_at (TIMESTAMP)          â† ANCHOR FOR DELTA
  created_at, updated_at
  
  Unique Constraint: (user_id, book_id)


ğŸ›£ï¸  MAIN ROUTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Frontend Routes (auth + is.student):
  GET  /home                         â†’ HomeController@index
  GET  /buku/{id}                   â†’ BookController@show
  GET  /buku/{id}/read              â†’ BookController@read (reader page)
  POST /buku/{id}/start             â†’ BookController@startReading
  POST /buku/{id}/progress          â†’ BookController@updateReadingProgress
  POST /buku/{id}/ping              â†’ BookController@ping â­ TIMER
  GET  /history                     â†’ HistoryController@index
  GET  /search                      â†’ SearchController@index

Admin Routes (auth + is.admin):
  GET  /admin/dashboard             â†’ DashboardController@index
  GET  /admin/books                 â†’ BookController@index
  GET  /admin/users                 â†’ UserController@index
  [CRUD operations for books and users]

Auth Routes:
  GET  /login                       â†’ LoginController@showLoginForm
  POST /login                       â†’ LoginController@login
  POST /logout                      â†’ LoginController@logout
  POST /theme/toggle                â†’ LoginController@toggleTheme


â­ KEY FILES FOR TIMER FUNCTIONALITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Backend Files:

  app/Http/Controllers/Frontend/BookController.php
    â”œâ”€ ping($id)                     â† MAIN TIMER LOGIC
    â”‚  â””â”€ POST /buku/{id}/ping
    â”‚  â””â”€ Accumulates time every 15 seconds
    â”œâ”€ read($id)                     â† Initialize reader
    â”‚  â””â”€ Creates History record
    â”œâ”€ updateReadingProgress($id)    â† Save page number
    â””â”€ startReading($id)             â† Start reading

  app/Http/Controllers/Frontend/HomeController.php
    â””â”€ index()
       â””â”€ Calculates and displays total reading stats

  app/Http/Controllers/Frontend/HistoryController.php
    â””â”€ index()
       â””â”€ Shows reading history with stats

  app/Models/History.php
    â””â”€ Stores reading session data (total_time_spent, last_ping_at)

  routes/web.php
    â””â”€ Route definitions including POST /buku/{id}/ping

Frontend Files:

  resources/views/frontend/reader.blade.php â­ MAIN
    â”œâ”€ Lines 42-46: Pa
